(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{488:function(s,t,a){s.exports=a.p+"assets/img/PythonSeven.97c2521e.jpg"},691:function(s,t,a){"use strict";a.r(t);var n=a(7),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"什么是-uvicorn"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是-uvicorn"}},[s._v("#")]),s._v(" 什么是 Uvicorn ？")]),s._v(" "),n("p",[s._v("答：Uvicorn 是基于 uvloop 和 httptools 构建的非常快速的 ASGI 服务器。")]),s._v(" "),n("h2",{attrs:{id:"什么是-uvloop-和-httptools"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是-uvloop-和-httptools"}},[s._v("#")]),s._v(" 什么是 uvloop 和 httptools ？")]),s._v(" "),n("p",[s._v("答： uvloop 用于替换标准库 asyncio 中的事件循环，使用 Cython 实现，它非常快，可以使 asyncio 的速度提高 2-4 倍。asyncio 不用我介绍吧，写异步代码离不开它。")]),s._v(" "),n("p",[s._v("httptools 是 nodejs HTTP 解析器的 Python 实现。")]),s._v(" "),n("h2",{attrs:{id:"什么是-asgi-服务器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是-asgi-服务器"}},[s._v("#")]),s._v(" 什么是 ASGI 服务器？")]),s._v(" "),n("p",[s._v("答： 异步网关协议接口，一个介于网络协议服务和 Python 应用之间的标准接口，能够处理多种通用的协议类型，包括 HTTP，HTTP2 和 WebSocket。")]),s._v(" "),n("h2",{attrs:{id:"请简单介绍下-uvicorn"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#请简单介绍下-uvicorn"}},[s._v("#")]),s._v(" 请简单介绍下 Uvicorn")]),s._v(" "),n("p",[s._v("答：目前，Python 仍缺乏异步的网关协议接口，ASGI 的出现填补了这一空白，现在开始，我们能够使用共同的标准为所有的异步框架来实现一些工具，ASGI 帮助 Python 在 Web 框架上和 Node.JS 及 Golang 相竟争，目标是获得高性能的 IO 密集型任务，ASGI 支持 HTTP2 和 WebSockets，WSGI 是不支持的。")]),s._v(" "),n("p",[s._v("Uvicorn 目前支持 HTTP1.1 和 WebSocket，计划支持 HTTP2。")]),s._v(" "),n("h2",{attrs:{id:"使用方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用方法"}},[s._v("#")]),s._v(" 使用方法：")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("$ pip install uvicorn\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("创建一个文件 example.py")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("async")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scope"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" receive"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" send"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("assert")]),s._v(" scope"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http'")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("await")]),s._v(" send"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http.response.start'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'status'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'headers'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("b'content-type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("b'text/plain'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("await")]),s._v(" send"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http.response.body'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'body'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("b'Hello, world!'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("启动 Uvicorn")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("$ uvicorn example"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("app\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("你也可以不使用命令行，直接运行你的脚本也是可以的，如下：")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" uvicorn\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("async")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scope"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" receive"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" send"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" __name__ "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"__main__"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    uvicorn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("run"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"example:app"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" port"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" log_level"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"info"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("使用命令行时，你可以使用 "),n("code",[s._v("uvicorn --help")]),s._v(" 来获取帮助。")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("Usage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" uvicorn "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTIONS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" APP\n\nOptions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("host TEXT                     Bind socket to this host"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                                  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("port INTEGER                  Bind socket to this port"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("uds TEXT                      Bind to a UNIX domain socket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("fd INTEGER                    Bind to socket "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" this "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("file")]),s._v(" descriptor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("reload")]),s._v("                        Enable auto"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("reload")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("reload")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("dir")]),s._v(" TEXT               Set "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("reload")]),s._v(" directories explicitly"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" instead\n                                  of using the current working directory"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("workers INTEGER               Number of worker processes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" Defaults to the\n                                  $WEB_CONCURRENCY environment variable "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v("\n                                  available"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" Not valid "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("reload")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("loop "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("auto"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("asyncio"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("uvloop"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("iocp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n                                  Event loop implementation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" auto"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("auto"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("h11"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("httptools"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("     HTTP protocol implementation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                                  auto"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ws "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("auto"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("websockets"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("wsproto"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n                                  WebSocket protocol implementation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n                                  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" auto"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("lifespan "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("auto"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("on"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("        Lifespan implementation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" auto"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("interface "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("auto"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("asgi3"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("asgi2"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("wsgi"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n                                  Select ASGI3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ASGI2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("or")]),s._v(" WSGI "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" the\n                                  application interface"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" auto"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("env"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("file")]),s._v(" PATH                 Environment configuration "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("file")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config PATH               Logging configuration "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("file")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("level "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("critical"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("error"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("warning"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("info"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("debug"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("trace"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n                                  Log level"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("access"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("no"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("access"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log  Enable"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Disable access log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("use"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("colors "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("no"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("use"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("colors  Enable"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Disable colorized logging"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("headers "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("no"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("headers\n                                  Enable"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Disable X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Proto"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                  X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("For"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Port to\n                                  populate remote address info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("allow"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ips TEXT      Comma separated "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("list")]),s._v(" of IPs to trust "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v("\n                                  proxy headers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" Defaults to the\n                                  $FORWARDED_ALLOW_IPS environment variable "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v("\n                                  available"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("or")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'127.0.0.1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("root"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("path TEXT                Set the ASGI "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root_path'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" applications\n                                  submounted below a given URL path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("limit"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("concurrency INTEGER     Maximum number of concurrent connections "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("or")]),s._v("\n                                  tasks to allow"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" before issuing HTTP "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v("\n                                  responses"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("backlog INTEGER               Maximum number of connections to hold "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\n                                  backlog\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("limit"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("max")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("requests INTEGER    Maximum number of requests to service before\n                                  terminating the process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("timeout"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("keep"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("alive INTEGER    Close Keep"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Alive connections "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" no new data\n                                  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("is")]),s._v(" received within this timeout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                                  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ssl"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("keyfile TEXT              SSL key "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("file")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ssl"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("certfile TEXT             SSL certificate "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("file")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ssl"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("version INTEGER           SSL version to use "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("see stdlib ssl module's"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ssl"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("reqs INTEGER         Whether client certificate "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("is")]),s._v(" required "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("see\n                                  stdlib ssl module's"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ssl"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("certs TEXT             CA certificates "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("file")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ssl"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ciphers TEXT              Ciphers to use "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("see stdlib ssl module's"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                                  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("default"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" TLSv1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("header TEXT                   Specify custom default HTTP response headers\n                                  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" a Name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("Value pair\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("help")]),s._v("                          Show this message "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("and")]),s._v(" exit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br")])]),n("h2",{attrs:{id:"使用进程管理器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用进程管理器"}},[s._v("#")]),s._v(" 使用进程管理器")]),s._v(" "),n("p",[s._v("使用进程管理器确保你以弹性方式运行运行多个进程，你可以执行服务器升级而不会丢弃客户端的请求。")]),s._v(" "),n("p",[s._v("一个进程管理器将会处理套接字设置，启动多个服务器进程，监控进程活动，监听进程重启、关闭等信号。")]),s._v(" "),n("p",[s._v("Uvicorn 提供一个轻量级的方法来运行多个工作进程，比如 "),n("code",[s._v("--workers 4")]),s._v("，但并没有提供进行的监控。")]),s._v(" "),n("h3",{attrs:{id:"使用-gunicorn"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-gunicorn"}},[s._v("#")]),s._v(" 使用 Gunicorn")]),s._v(" "),n("p",[s._v("Gunicorn 是成熟的，功能齐全的服务器，Uvicorn 内部包含有 Guicorn 的 workers 类，允许你运行 ASGI 应用程序，这些 workers 继承了所有 Uvicorn 高性能的特点，并且给你使用 Guicorn 来进行进程管理。")]),s._v(" "),n("p",[s._v("这样的话，你可能动态增加或减少进程数量，平滑地重启工作进程，或者升级服务器而无需停机。")]),s._v(" "),n("p",[s._v("在生产环境中，Guicorn 大概是最简单的方式来管理 Uvicorn 了，生产环境部署我们推荐使用 Guicorn 和 Uvicorn 的 worker 类：")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("gunicorn example"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("app "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("w "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("k uvicorn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("workers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("UvicornWorker\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("执行上述命令将开户 4 个工作进程，其中 UvicornWorker 的实现使用 uvloop 和httptools 实现。在 PyPy 下运行，你可以使用纯 Python 实现，可以通过使用UvicornH11Worker 类来做到这一点。")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("gunicorn "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("w "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("k uvicorn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("workers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("UvicornH11Worker\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("Gunicorn 为 Uvicorn 提供了不同的配置选项集，但是一些配置暂不支持，如"),n("code",[s._v("--limit-concurrency")]),s._v(" 。")]),s._v(" "),n("h3",{attrs:{id:"使用-supervisor"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-supervisor"}},[s._v("#")]),s._v(" 使用 Supervisor")]),s._v(" "),n("p",[s._v("Supervisor 作为进程管理器，以下两点二选一：")]),s._v(" "),n("ul",[n("li",[s._v("使用其文件描述符将套接字移交给 uvicorn，supervisor 始终将文件描述符置 0，并且必须在本 fcgi-program 中进行设置。")]),s._v(" "),n("li",[s._v("为每个 uvicorn 进程使用 UNIX 套接字。")])]),s._v(" "),n("p",[s._v("一个简单的主管配置可能看起来像这样： administratord.conf：")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("supervisord"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("fcgi"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("program：uvicorn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \nsocket "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" tcp："),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v(" localhost："),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v(" \n命令"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" venv "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bin")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" uvicorn "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("fd "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("示例：App \nnumprocs "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" \nprocess_name "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" uvicorn"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("％（process_num）d \nstdout_logfile "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" dev "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("标准输出\nstdout_logfile_maxbytes "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n然后运行supervisord "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("n。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h3",{attrs:{id:"使用-circus"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-circus"}},[s._v("#")]),s._v(" 使用 Circus")]),s._v(" "),n("p",[s._v("使用 Circus 与 Supervisor 很类似。配置文件 circus.ini 如下：")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("watcher"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ncmd "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" venv"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bin")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("uvicorn "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("fd $"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("circus"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sockets"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" example"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("App\nuse_sockets "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),s._v("\nnumprocesses "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("socket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("web"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nhost "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v("\nport "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h2",{attrs:{id:"与-nginx-部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#与-nginx-部署"}},[s._v("#")]),s._v(" 与 Nginx 部署")]),s._v(" "),n("p",[s._v("Nginx 作为 Uvicorn 进程的代理并不是必须的，你可以使用 Nginx 做为负载均衡。推荐使用 Nginx 时配置请求头，如 "),n("code",[s._v("X-Forwarded-For")]),s._v(","),n("code",[s._v("X-Forwarded-Proto")]),s._v("，以便 Uvicorn 识别出真正的客户端信息，如 IP 地址，scheme 等。这里有一个配置文件的样例：")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("http "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  server "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    listen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    client_max_body_size 4G"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    server_name example"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    location "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      proxy_set_header Host $http_host"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      proxy_set_header X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("For $proxy_add_x_forwarded_for"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      proxy_set_header X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forwarded"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Proto $scheme"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      proxy_redirect off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      proxy_buffering off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      proxy_pass http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("uvicorn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    location "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("static "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# path for static files")]),s._v("\n      root "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("to"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("app"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("static"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  upstream uvicorn "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    server unix"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tmp"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("uvicorn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("h2",{attrs:{id:"使用-https"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-https"}},[s._v("#")]),s._v(" 使用 HTTPS")]),s._v(" "),n("p",[s._v("使用 HTTPS 证书是必须的，推荐使用免费的 Let's Encrypt。")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("\n$ uvicorn example"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("app "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("port "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ssl"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("keyfile"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ssl"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("certfile"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("使用 Gunicorn 也可以直接使用证书。")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("$ gunicorn "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("keyfile"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("certfile"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cert"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("k uvicorn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("workers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("UvicornWorker example"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("app\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"参考文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考文档"}},[s._v("#")]),s._v(" 参考文档")]),s._v(" "),n("ol",[n("li",[n("a",{attrs:{href:"https://www.uvicorn.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档-介绍"),n("OutboundLink")],1),s._v("。")]),s._v(" "),n("li",[n("a",{attrs:{href:"https://www.uvicorn.org/deployment/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档-部署"),n("OutboundLink")],1),s._v("。")])]),s._v(" "),n("p",[s._v("关注微信公众号：Python七号，和我一起学习 Python。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(488),alt:""}})])])}),[],!1,null,null,null);t.default=r.exports}}]);
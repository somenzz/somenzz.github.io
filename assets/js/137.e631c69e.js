(window.webpackJsonp=window.webpackJsonp||[]).push([[137],{722:function(t,s,a){"use strict";a.r(s);var n=a(7),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("blockquote",[a("p",[t._v("文章首发于公众号「Python七号」")])]),t._v(" "),a("p",[t._v("记得之前看过一篇文章，说的是龙哥当年准备卖掉 foxmail，买方是雷军，雷军的意思是：就这，我也能写。于是就没有成交。")]),t._v(" "),a("p",[t._v("我的感觉就是，程序员写的软件，要给不懂技术的人用才有价值，否则得到的就是：就这，我也能写。")]),t._v(" "),a("p",[t._v("我们不是龙哥，写不出牛逼的 foxmail，但是写个自动化的脚本还是可以的，即使是一个小小的脚本，只要能提供帮助，其他人也是有需求的。")]),t._v(" "),a("p",[t._v("那么如何将你写的程序发布给其他人用呢？")]),t._v(" "),a("p",[t._v("我尝试过一些常用的打包工具，py2exe，pyinstaller，这些工具有一些缺点：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("不稳定。明明我自己的电脑可以运行，放到其他电脑就会报错闪退，提示系统缺少 xxx.dll 动态链接库文件。")])]),t._v(" "),a("li",[a("p",[t._v("配置文件复杂。简单的打包方式可能无法满足需要，复杂一些的就要写配置文件，有时明明写好的配置文件，就是没有生效。")])]),t._v(" "),a("li",[a("p",[t._v("打包文件大，启动慢。这些工具并不会编译成可执行文件，而是将 Python 解释器，依赖的三方库一起打包，如果打包成一个文件，运行超慢，因为这些会一起加载进内存。")])])]),t._v(" "),a("p",[t._v("还有一种方式就是编写 Web 应用程序，发布成 Web 站点、H5、微信小程序等形式，这个门槛就有点高了，你需要有一定的经验且熟悉 Web 开发，还要购买服务器或者云产品。")]),t._v(" "),a("p",[t._v("今天分享一下非常简单可行的方式发布 Python 应用程序，发布后用户只需要双击一个文件就可以启动你的应用程序，不懂任何技术的人都会使用。")]),t._v(" "),a("p",[t._v("具体的方法就是使用官网发布的嵌入式 Python 包，不过这个仅适用于 Windows，这也不是什么大不了的，大多数非程序员用的都是 Windows。「如果是 Mac 请使用 py2app 来打包」")]),t._v(" "),a("p",[t._v("访问 "),a("a",{attrs:{href:"www.python.org"}},[t._v("www.python.org")]),t._v(" 下载 Windows embeddable package，如果你自己的电脑是 64 位的，就下载 64 位，如果要做的更通用些就用 32 位的，因为 64 位电脑可以运行 32 位的程序，反之则不行。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008i3skNgy1gqgm2c7i5qj310k0t6766.jpg",alt:""}})]),t._v(" "),a("p",[t._v("这里我选择 python-3.9.5，解压后得到 python-3.9.5-embed-amd64 文件夹，这是一个免安装的 Python 环境，随便复制到其他 Windows 平台都可以稳定运行。进入目录，执行 .\\python，只要是标准库都可以导入。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008i3skNgy1gqgtdwwnuaj317s0do74y.jpg",alt:""}})]),t._v(" "),a("p",[t._v("不过在正式使用之前，我们还需要进行两点改造。")]),t._v(" "),a("h3",{attrs:{id:"安装-pip-工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-pip-工具"}},[t._v("#")]),t._v(" 安装 pip 工具")]),t._v(" "),a("p",[t._v("我们写程序不可能只用标准库，还要使用第三方库，比如 requests，那么就要为 Python 环境配置 pip。")]),t._v(" "),a("ol",[a("li",[t._v("从这里下载 get-pip.py 文件")])]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("https://bootstrap.pypa.io/get-pip.py\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("将 get-pip.py 存放在 python-3.9.5-embed-amd64 文件夹中，然后进入该目录执行:")])]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("python get-pip.py  --no-warn-script-location\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("即可完成 pip 的安装：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008i3skNgy1gqgu8x4947j31ii0h60v8.jpg",alt:""}})]),t._v(" "),a("p",[t._v("此时 pip 已经安装在 Lib\\site-packages 下。")]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("使用 pip")])]),t._v(" "),a("p",[t._v("现在安装 requests 并 import 测试。发现报了个错，说找不到 pip。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008i3skNgy1gqguuntth8j315e09kt9d.jpg",alt:""}})]),t._v(" "),a("p",[t._v("好，现在进入 Python 解释器环境，看下 Python 的搜索路径 sys.path，发现并没有 Lib\\site-packages，那么就添加它。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008i3skNgy1gqgsiho0puj317o0hm75c.jpg",alt:""}})]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[t._v("添加搜索路径")])]),t._v(" "),a("p",[t._v("进入 python-3.9.5-embed-amd64 文件夹，修改文件 "),a("code",[t._v("python39._pth")]),t._v(" 文件")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008i3skNgy1gqgs4e1jelj30km07u0sv.jpg",alt:""}})]),t._v(" "),a("p",[t._v("修改之后内容如下：")]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[t._v("python39"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("zip")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Uncomment to run site.main() automatically")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" site\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("这里修改了两个地方，一个是加入上级目录 "),a("code",[t._v("..")]),t._v("，另一个是取消注释 "),a("code",[t._v("import site")]),t._v("。")]),t._v(" "),a("p",[t._v("加入上级目录是为了在该目录之外存放一些自己写的 Python 脚本，这样目录 python-3.9.5-embed-amd64 就可以保持独立，不放入任何自己写的脚本，免得 Python 环境相关的文件被污染。")]),t._v(" "),a("p",[t._v("取消注释 "),a("code",[t._v("import site")]),t._v(" 会自动运行 site.main()，查看 Python 的 Lib/site.py 的源代码就可以知道 site.main() 会将 "),a("code",[t._v("Lib\\site-packages")]),t._v(" 自动添加到 sys.path 中，当然它的功能还不止这些，我们先知道这些就够了。")]),t._v(" "),a("p",[t._v("接下来再次查看 sys.path，发现 "),a("code",[t._v("Lib\\site-packages")]),t._v(" 已经在里面了：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008i3skNgy1gqguzzc93fj317c0fygmy.jpg",alt:""}})]),t._v(" "),a("p",[t._v("再次安装 requests 并导入测试，成功:")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008i3skNgy1gqgv15nh54j31dw0tidkn.jpg",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"发布程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#发布程序"}},[t._v("#")]),t._v(" 发布程序")]),t._v(" "),a("p",[t._v("现在就可以写代码发布程序了，我这里写好了一个脚本 main.py 获取用户输入的文本，自动调用百度翻译，返回翻译的结果，内容如下：")]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" json\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" requests\nurl"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://fanyi.baidu.com/sug'")]),t._v("\nkw "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("input")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'请输入待翻译的文本：'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nkw "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'kw'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("kw\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nheader "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'User-Agent'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.132 Safari/537.36'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nresponse "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" requests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("post"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("kw"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" headers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("header"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nresponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("raise_for_status\nresponse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("encoding "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("apparent_encoding\ncontent_json "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#默认转成ascii编码，因此需要设置成false")]),t._v("\ncontent "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dumps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("content_json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ensure_ascii"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nresult "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loads"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("content"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"data"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br")])]),a("p",[t._v("然后放在与 python-3.9.5-embed-amd64 文本夹并列的位置，考虑到有人不会打开命令窗口，我们还需要制作一个 bat 脚本文件，用户双击这个文件就可以运行我们的程序，内容如下：")]),t._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("cmd.exe /K ."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("python-3.9.5-embed-amd64"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("python main.py\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("这里 cmd 传入 /K 参数是为了程序运行完成后不关闭命令窗口，这样我们就可以看到程序返回了啥，不然直接唰的一下窗口就没了。")]),t._v(" "),a("p",[t._v("最终文件夹如下所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008i3skNgy1gqgvkdmjq1j30h209c74d.jpg",alt:""}})]),t._v(" "),a("p",[t._v("现在将 main.py、双击运行.bat、python-3.9.5-embed-amd64 压缩到一个文件夹 embed_python.7z，发送给需要的人，他解压后，双击那个 bat 文件就可以运行你的程序了：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008i3skNgy1gqgvrbieobj30zc0badgl.jpg",alt:""}})]),t._v(" "),a("p",[t._v("压缩后只有 10 MB 的大小，微信上就可以直接传输了，方便。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008i3skNgy1gqgvnbjtovj31j80ck0tt.jpg",alt:""}})]),t._v(" "),a("p",[t._v("如果你嫌上述的制作过程麻烦，可以直接使用我做好的嵌入式 Python 包，解压后就可以直接使用，公众号「Python七号」回复「嵌入式」获取。")]),t._v(" "),a("p",[t._v("关注公众号「Python七号」，学习更多 Python 编程技巧。")])])}),[],!1,null,null,null);s.default=e.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[207],{787:function(t,s,a){"use strict";a.r(s);var n=a(7),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("不知道大家有没有这种体验，代码写完之后，要花大量的时间进行构建和测试，就拿 Python 来说吧，写完代码后，编写测试用例，准备测试环境，执行测试，完成构建，部署到服务器。")]),t._v(" "),a("p",[t._v("后面每改动一次代码，都要准备测试环境，执行测试，完成构建，部署到服务器，执行这一系列过程，相当耗时，尤其是在多个 Python 版本间进行测试时，简直就是体力活。")]),t._v(" "),a("p",[t._v("不过，现在这个问题不存在了，只要你会用 Travis Ci 这个持续集成工具。")]),t._v(" "),a("p",[t._v("Travis Ci 是一个基于云的, 绑定 GitHub 上的项目后，只要有新的代码提交，就会自动执行测试，完成构建，部署到服务器这一些列重复枯燥的过程，每次代码的小幅变更，我们就能很快看到运行结果，从而不断累积小的变更。这种及时反馈可以大大提升开发效率。")]),t._v(" "),a("p",[t._v("比如我有一个 GitHub 仓库，里面写好了单元测试，然后修改了代码之后提交到 GitHub，很快就可以看到构建的结果是 pass 还是 failed：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24egy1h05jjoc6lyj215u0fut9f.jpg",alt:""}})]),t._v(" "),a("p",[t._v("当然，这个过程是需要我们配置的。")]),t._v(" "),a("p",[t._v("接下来分享下如何简单的使用 Travis Ci ，工具是开源免费的。")]),t._v(" "),a("h2",{attrs:{id:"_1、前提条件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、前提条件"}},[t._v("#")]),t._v(" 1、前提条件")]),t._v(" "),a("p",[t._v("你需要在代码托管平台有一个项目，或者叫仓库，英文 repositories。")]),t._v(" "),a("p",[t._v("代码托管平台目前支持 GitHub、Bitbucket、GitLab、Assembla。")]),t._v(" "),a("p",[t._v("你是仓库的所有者。")]),t._v(" "),a("h2",{attrs:{id:"_2、为仓库编写配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、为仓库编写配置文件"}},[t._v("#")]),t._v(" 2、为仓库编写配置文件")]),t._v(" "),a("p",[t._v("在"),a("a",{attrs:{href:"https://github.com/somenzz/dbinterface",target:"_blank",rel:"noopener noreferrer"}},[t._v("仓库"),a("OutboundLink")],1),t._v("的根目录添加一个 .travis.yml 配置文件，来告诉 travis-ci 做什么。")]),t._v(" "),a("p",[t._v("比如我这里的一个 .travis.yml 配置文件如下所示：")]),t._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("language")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" python\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("python")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3.7"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3.8"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3.9"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# command to install dependencies")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#install:")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  - pip install tox")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# command to run tests")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" python setup.py sdist bdist_wheel\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("notifications")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("email")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("recipients")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" somenzz@163.com\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on_success")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" change\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on_failure")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br")])]),a("p",[t._v("上面代码中：")]),t._v(" "),a("ul",[a("li",[t._v("language 字段指定了编程语言，目前支持大部分主流编程语言")]),t._v(" "),a("li",[t._v("python 设定使用 Python 环境的版本")]),t._v(" "),a("li",[t._v("script 字段指定要运行的脚本，如果 script: true 表示不执行任何脚本，状态直接设为成功")])]),t._v(" "),a("p",[t._v("如果有多个脚本，可以写成下面的形式:")]),t._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" command1\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" command2\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("如果 command1 失败，command2 会继续执行。但是，整个构建阶段的状态是失败。\n如果 command2 只有在 command1 成功后才能执行，就要写成这样 "),a("code",[t._v("script: command1 && command2")])]),t._v(" "),a("ul",[a("li",[t._v("notifications 就是通知了，script 执行失败的话发邮件通知")])]),t._v(" "),a("p",[t._v("还有 install 命令我注释掉了，该字段用来指定安装依赖，如果有多个命令要执行，可以写成下面的形式。")]),t._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("install")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" command1\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" command2\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("上面代码中，如果 command1 失败了，整个构建就会停下来，不再往下进行。如果不需要安装，即跳过安装阶段，就直接设为true。")]),t._v(" "),a("p",[t._v("配置文件之前，我们需要自己本地执行一下 script 里面的命令，没有问题时再提交 .travis.yml 进行下一步。")]),t._v(" "),a("h2",{attrs:{id:"_2、登录-travis-ci-监听这个项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、登录-travis-ci-监听这个项目"}},[t._v("#")]),t._v(" 2、登录 travis-ci，监听这个项目")]),t._v(" "),a("p",[t._v("访问 https://app.travis-ci.com/signin 并使用一个平台账号登录：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24egy1h05juo3hzyj20u00wnq42.jpg",alt:""}})]),t._v(" "),a("p",[t._v("以 GitHub 为例，登进去后，我们会看到自己的仓库列表。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24egy1h05kr13xm6j211i0u0wga.jpg",alt:""}})]),t._v(" "),a("p",[t._v("选择仓库前面的小圆圈，激活该仓库。")]),t._v(" "),a("p",[t._v("这里看到 dbinterface 已经激活了，点击进去，可以查看提交、构建的情况，只有我们 git push 这个仓库，就会自动构建，也可以点击按钮重新构建。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24egy1h05kt59ijqj21m60u0djz.jpg",alt:""}})]),t._v(" "),a("p",[t._v("点击下方的构建条目可以看到详细的日志：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24egy1h05kvo7tqrj21360u041u.jpg",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"_3、其他骚操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、其他骚操作"}},[t._v("#")]),t._v(" 3、其他骚操作")]),t._v(" "),a("p",[t._v("script 阶段结束以后，除了设置通知步骤（notification）还可以进行部署（deployment）比如，要部署到 Github Pages，可以写成下面这样。")]),t._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("provider")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" pages\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("skip_cleanup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("github_token")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $GITHUB_TOKEN "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在 travis-ci.com 面板设置")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" master\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[t._v("其他部署方式，请看"),a("a",{attrs:{href:"https://docs.travis-ci.com/user/deployment/",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("p",[t._v("不过 GitHub Actions 更为方便，可以查看前文："),a("a",{attrs:{href:"https://mp.weixin.qq.com/s/5lDtNppd3foWGHUJ1_RrDg",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub Actions入门教程：自动化部署静态博客"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"最后的话"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#最后的话"}},[t._v("#")]),t._v(" 最后的话")]),t._v(" "),a("p",[t._v("如果你是 Github 的爱好者，那么 Travis 绝对值得一试。如果觉得本文有帮助，还请点个在看，感谢老铁支持。")]),t._v(" "),a("p",[t._v("推荐阅读")]),t._v(" "),a("p",[a("a",{attrs:{href:"http://docs.travis-ci.com/user/languages/python/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Travis Ci 官网提供的教程 Python"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://mp.weixin.qq.com/s/LcGeI2LjiJJGSIZvkvaUYw",target:"_blank",rel:"noopener noreferrer"}},[t._v("与 coveralls 的不解之缘"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);